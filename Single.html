<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ICCI Banking — Demo</title>
  <style>
    :root{--bg:#f4f7fb;--card:#ffffff;--accent:#0b72ff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);margin:0;padding:24px}
    header{display:flex;align-items:center;gap:16px}
    .brand{display:flex;flex-direction:column}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .layout{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:20px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(11,23,60,0.06)}
    .controls label{display:block;font-size:13px;margin-top:12px;color:var(--muted)}
    input,select,button{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;margin-top:6px;font-size:14px}
    button.primary{background:var(--accent);color:white;border:none;cursor:pointer}
    .accounts{margin-top:14px}
    .acct{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:#fbfdff;margin-top:8px}
    .flex{display:flex;gap:10px;align-items:center}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;text-align:left;border-bottom:1px solid #f0f2f6;font-size:13px}
    .muted{color:var(--muted);font-size:13px}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    @media (max-width:820px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div style="width:48px;height:48px;background:linear-gradient(135deg,#0b72ff,#4cc3ff);border-radius:10px;display:flex;align-items:center;justify-content:center;color:white;font-weight:700">IB</div>
    <div class="brand">
      <h1>ICCI Banking — Demo</h1>
      <p class="lead">Simple single-page demo. BankServer implemented as a Singleton in JavaScript.</p>
    </div>
  </header>

  <div class="layout">
    <section class="card">
      <h3>Create / Manage Account</h3>
      <div class="controls">
        <label>Account Holder Name <input id="inputName" placeholder="e.g. Priya Sharma"></label>
        <label>Initial Balance <input id="inputBalance" type="number" value="1000"></label>
        <button id="btnCreate" class="primary">Create Account</button>

        <div class="accounts">
          <h4 style="margin:8px 0">Accounts</h4>
          <div id="accountsList" class="muted">No accounts yet.</div>
        </div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid #f0f2f6">
      <h3>Transactions</h3>
      <label>From Account <select id="selFrom"><option value="">-- select --</option></select></label>
      <label>To Account <select id="selTo"><option value="">-- select --</option></select></label>
      <label>Amount <input id="inputAmt" type="number" value="100"></label>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="btnDeposit">Deposit</button>
        <button id="btnWithdraw">Withdraw</button>
        <button id="btnTransfer" class="primary">Transfer</button>
      </div>
    </section>

    <section class="card">
      <h3>Bank Dashboard</h3>
      <div class="flex" style="justify-content:space-between;align-items:flex-start">
        <div>
          <div class="muted">Total Accounts</div>
          <div id="totalAccounts" style="font-weight:700;font-size:20px">0</div>
        </div>
        <div>
          <div class="muted">Total Balance</div>
          <div id="totalBalance" style="font-weight:700;font-size:20px">₹0</div>
        </div>
      </div>

      <h4 style="margin-top:16px">Transaction History</h4>
      <table>
        <thead><tr><th>Time</th><th>Type</th><th>Details</th><th>Amount</th></tr></thead>
        <tbody id="txBody"><tr><td colspan="4" class="muted">No transactions yet.</td></tr></tbody>
      </table>

      <footer>
        <div>Implementation notes: BankServer is a singleton. The constructor is made "private" by using a closure and a private token — scripts must use <code>BankServer.getInstance()</code>.</div>
      </footer>
    </section>
  </div>

  <script>
    // ======= BankServer Singleton Implementation =======
    // We want a single instance across the app and the constructor should be "private".
    // JavaScript doesn't have private constructors like Java, but we can emulate the pattern.

    const BankServer = (function(){
      // A private token that only this IIFE knows.
      const _privateConstructorToken = Symbol('private');

      class BankServerClass {
        // Private fields (supported in modern browsers)
        #accounts = new Map(); // accountId -> {id,name,balance}
        #transactions = [];

        constructor(token) {
          // enforce private constructor by requiring that the caller passes the private token
          if (token !== _privateConstructorToken) {
            throw new Error('BankServer constructor is private. Use BankServer.getInstance()');
          }
          // init if needed
        }

        createAccount(name, initialBalance=0){
          const id = 'AC' + Date.now().toString(36) + Math.floor(Math.random()*900).toString();
          const acct = {id,name,balance: Number(initialBalance)};
          this.#accounts.set(id,acct);
          this.#logTx('CREATE', `${name} (${id})`, acct.balance);
          return acct;
        }

        getAccount(id){
          return this.#accounts.get(id) || null;
        }

        listAccounts(){
          return Array.from(this.#accounts.values());
        }

        deposit(id, amount){
          amount = Number(amount);
          const a = this.getAccount(id);
          if(!a) throw new Error('Account not found');
          if(amount <= 0) throw new Error('Amount must be > 0');
          a.balance += amount;
          this.#logTx('DEPOSIT', `${a.name} (${a.id})`, amount);
          return a.balance;
        }

        withdraw(id, amount){
          amount = Number(amount);
          const a = this.getAccount(id);
          if(!a) throw new Error('Account not found');
          if(amount <= 0) throw new Error('Amount must be > 0');
          if(a.balance < amount) throw new Error('Insufficient funds');
          a.balance -= amount;
          this.#logTx('WITHDRAW', `${a.name} (${a.id})`, -amount);
          return a.balance;
        }

        transfer(fromId, toId, amount){
          amount = Number(amount);
          if(fromId === toId) throw new Error('Cannot transfer to same account');
          const from = this.getAccount(fromId);
          const to = this.getAccount(toId);
          if(!from || !to) throw new Error('Account not found');
          if(amount <= 0) throw new Error('Amount must be > 0');
          if(from.balance < amount) throw new Error('Insufficient funds');
          from.balance -= amount;
          to.balance += amount;
          this.#logTx('TRANSFER', `${from.name} (${from.id}) -> ${to.name} (${to.id})`, amount);
          return {fromBalance: from.balance, toBalance: to.balance};
        }

        // Private logger
        #logTx(type, details, amount){
          this.#transactions.unshift({time:new Date().toISOString(),type,details,amount});
        }

        getTransactions(limit=50){
          return this.#transactions.slice(0,limit);
        }

        // Derived info
        getTotalBalance(){
          let sum = 0;
          for(const a of this.#accounts.values()) sum += a.balance;
          return sum;
        }

        getCount(){
          return this.#accounts.size;
        }
      }

      // Private variable holding the singleton instance
      let instance = null;

      return {
        // only public API we expose: getInstance
        getInstance: function(){
          if(!instance) instance = new BankServerClass(_privateConstructorToken);
          return instance;
        }
      };
    })();

    // ======= UI glue code =======
    const b = BankServer.getInstance();

    const el = {
      btnCreate:document.getElementById('btnCreate'),
      inputName:document.getElementById('inputName'),
      inputBalance:document.getElementById('inputBalance'),
      accountsList:document.getElementById('accountsList'),
      selFrom:document.getElementById('selFrom'),
      selTo:document.getElementById('selTo'),
      inputAmt:document.getElementById('inputAmt'),
      btnDeposit:document.getElementById('btnDeposit'),
      btnWithdraw:document.getElementById('btnWithdraw'),
      btnTransfer:document.getElementById('btnTransfer'),
      totalAccounts:document.getElementById('totalAccounts'),
      totalBalance:document.getElementById('totalBalance'),
      txBody:document.getElementById('txBody')
    };

    function refreshUI(){
      const accounts = b.listAccounts();
      if(accounts.length===0){
        el.accountsList.innerHTML = '<div class="muted">No accounts yet.</div>';
      } else {
        el.accountsList.innerHTML = accounts.map(a=>`<div class="acct"><div><strong>${a.name}</strong><div class="muted">${a.id}</div></div><div>₹${a.balance.toFixed(2)}</div></div>`).join('');
      }
      // selectors
      const opts = ['<option value="">-- select --</option>'].concat(accounts.map(a=>`<option value="${a.id}">${a.name} (${a.id}) — ₹${a.balance.toFixed(2)}</option>`)).join('');
      el.selFrom.innerHTML = opts;
      el.selTo.innerHTML = opts;

      el.totalAccounts.textContent = b.getCount();
      el.totalBalance.textContent = '₹' + b.getTotalBalance().toFixed(2);

      const txs = b.getTransactions(50);
      if(txs.length===0){
        el.txBody.innerHTML = '<tr><td colspan="4" class="muted">No transactions yet.</td></tr>';
      } else {
        el.txBody.innerHTML = txs.map(t=>`<tr><td>${new Date(t.time).toLocaleString()}</td><td>${t.type}</td><td>${t.details}</td><td>${t.amount>0? '₹'+t.amount.toFixed(2): '₹'+(t.amount).toFixed(2)}</td></tr>`).join('');
      }
    }

    el.btnCreate.addEventListener('click', ()=>{
      const name = el.inputName.value.trim();
      const bal = Number(el.inputBalance.value || 0);
      if(!name){alert('Enter account holder name');return}
      try{
        b.createAccount(name,bal);
        el.inputName.value=''; el.inputBalance.value='1000';
        refreshUI();
      }catch(e){alert(e.message)}
    });

    el.btnDeposit.addEventListener('click', ()=>{
      const id = el.selFrom.value; const amt = Number(el.inputAmt.value);
      if(!id){alert('Select an account (From)');return}
      try{b.deposit(id,amt); refreshUI();}catch(e){alert(e.message)}
    });
    el.btnWithdraw.addEventListener('click', ()=>{
      const id = el.selFrom.value; const amt = Number(el.inputAmt.value);
      if(!id){alert('Select an account (From)');return}
      try{b.withdraw(id,amt); refreshUI();}catch(e){alert(e.message)}
    });
    el.btnTransfer.addEventListener('click', ()=>{
      const from = el.selFrom.value; const to = el.selTo.value; const amt = Number(el.inputAmt.value);
      if(!from || !to){alert('Select both From and To accounts');return}
      try{b.transfer(from,to,amt); refreshUI();}catch(e){alert(e.message)}
    });

    // create some demo data
    (function seed(){
      try{
        b.createAccount('Rohit Kumar',5000);
        b.createAccount('Ayesha Khan',12000);
        b.createAccount('Manish Patel',2500);
        refreshUI();
      }catch(e){/*ignore*/}
    })();

    // Expose BankServer to the window for debugging (read-only). Do not allow direct construction.
    Object.defineProperty(window,'BankServerInstance',{get:()=>BankServer.getInstance()});

  </script>
</body>
</html>
